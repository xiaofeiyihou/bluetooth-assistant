#:import Color kivy.utils.get_color_from_hex

<BluetoothAppUI>:
    orientation: 'vertical'
    padding: 20
    spacing: 15
    
    # 标题栏
    BoxLayout:
        size_hint_y: None
        height: '60dp'
        
        Label:
            text: '手机蓝牙助手'
            font_size: '24sp'
            color: Color('#4A90E2') if root.is_connected else Color('#666666')
            halign: 'center'
            valign: 'center'
    
    # 状态栏
    BoxLayout:
        size_hint_y: None
        height: '40dp'
        
        Label:
            id: status_label
            text: '点击扫描开始查找蓝牙设备'
            font_size: '14sp'
            color: Color('#333333')
            halign: 'center'
            valign: 'center'
            text_size: (self.width, None)
    
    # 扫描按钮
    Button:
        id: scan_button
        text: '扫描蓝牙设备'
        size_hint_y: None
        height: '50dp'
        background_color: Color('#4A90E2')
        on_press: root.scan_devices()
        disabled: root.is_scanning
    
    # 设备列表区域
    BoxLayout:
        size_hint_y: 0.4
        
        ScrollView:
            id: devices_scroll
            do_scroll_x: False
            do_scroll_y: True
            
            BoxLayout:
                id: devices_layout
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                padding: 10
                spacing: 5
    
    # 通信区域
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: 0.35
        spacing: 10
        
        # 消息显示区域
        BoxLayout:
            size_hint_y: 0.7
            
            TextInput:
                id: message_display
                text: ''
                readonly: True
                background_color: Color('#F5F5F5')
                foreground_color: Color('#333333')
                cursor_color: Color('#4A90E2')
                font_size: '14sp'
        
        # 发送消息区域
        BoxLayout:
            size_hint_y: 0.3
            spacing: 10
            
            TextInput:
                id: message_input
                hint_text: '输入要发送的消息'
                multiline: False
                size_hint_x: 0.7
                background_color: Color('#FFFFFF')
                foreground_color: Color('#333333')
                cursor_color: Color('#4A90E2')
                font_size: '16sp'
            
            Button:
                id: send_button
                text: '发送'
                size_hint_x: 0.3
                background_color: Color('#4A90E2') if root.is_connected else Color('#CCCCCC')
                on_press: root.send_message()
                disabled: not root.is_connected
    
    # 连接状态指示器
    BoxLayout:
        size_hint_y: None
        height: '30dp'
        
        Label:
            text: '连接状态: ' + ('已连接' if root.is_connected else '未连接')
            font_size: '12sp'
            color: Color('#28A745') if root.is_connected else Color('#DC3545')
            halign: 'center'
            valign: 'center'